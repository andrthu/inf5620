import numpy as np

def step1(u,u_1,x,y,t,f,V,C1,C2,Nx,Ny,dt,b,q):

    u_xx = np.zeros(shape=(Nx,Ny))
    u_yy = np.zeros(shape=(Nx,Ny))

    u_xx[1:-1,1:-1]=0.5*(q(x[1:-1],y[1:-1])+q(x[2:],y[1:-1]))*(u_1[2:,1:-1]-u_1[1:-1,1:-1])-0.5*(q(x[1:-1],y[1:-1])+q(x[:-2],y[1:-1]))*(u_1[1:-1,1:-1]-u_1[:-2,1:-1])

    u_yy[1:-1,1:-1]=0.5*(q(x[1:-1],y[1:-1])+q(x[1:-1],y[2:]))*(u_1[1:-1,2:]-u_1[1:-1,1:-1])-0.5*(q(x[1:-1],y[1:-1])+q(x[1:-1],y[:-2]))*(u_1[1:-1,1:-1]-u_1[1:-1,:-2])

    #inner points +dt*V(x[1:-1],y[1:-1])
    u[1:-1,1:-1] = ((1+0.5*b*dt)*u_1[1:-1,1:-1] + 0.5*dt**2*f(x[1:-1],y[1:-1],0) +0.5*C1*u_xx[1:-1,1:-1] + 0.5*C2*u_yy[1:-1,1:-1])/( 1 + 0.5*b*dt )

    #edges
    u[0,0] = u[1,1]
    u[0,Ny-1] = u[1,Ny-2]
    u[Nx-1,0] = u[Nx-2,1]
    u[Nx-1,Ny-1] = u[Nx-2,Ny-2]
    
    #boudary for x=0
    u[0,1:-1] = ((1+0.5*b*dt)*u_1[0,1:-1]+dt*V(x[0],y[1:-1])+0.5*dt*f(x[0],y[1:-1],0)+C1*q(x[0],y[1:-1])*(u_1[1,1:-1]-u_1[0,1:-1])+0.25*C2*((q(x[0],y[1:-1])+q(x[0],y[2:]))*(u_1[0,2:]-u_1[0,1:-1])-(q(x[0],y[1:-1])+q(x[0],y[:-2]))*(u_1[0,1:-1]-u_1[0,:-2])))/( 1 + 0.5*b*dt )

    #boudary for x=Nx
    u[Nx-1,1:-1] = ((1+0.5*b*dt)*u_1[Nx-1,1:-1]+dt*V(x[Nx-1],y[1:-1])+0.5*dt*f(x[Nx-1],y[1:-1],0)+C1*q(x[Nx-1],y[1:-1])*(u_1[Nx-2,1:-1]-u_1[Nx-1,1:-1])+0.25*C2*((q(x[Nx-1],y[1:-1])+q(x[Nx-1],y[2:]))*(u_1[Nx-1,2:]-u_1[Nx-1,1:-1])-(q(x[Nx-1],y[1:-1])+q(x[Nx-1],y[:-2]))*(u_1[Nx-1,1:-1]-u_1[Nx-1,:-2])))/( 1 + 0.5*b*dt )

    

    #boudary for y=0
    u[1:-1,0] = ((1+0.5*b*dt)*u_1[1:-1,0]+dt*V(x[1:-1],y[0])+0.5*dt*f(x[1:-1],y[0],0)+C2*q(x[1:-1],y[0])*(u_1[1:-1,1]-u_1[1:-1,0])+0.25*C1*((q(x[1:-1],y[0])+q(x[2:],y[0]))*(u_1[2:,0]-u_1[1:-1,0])-(q(x[1:-1],y[0])+q(x[:-2],y[0]))*(u_1[1:-1,0]-u_1[:-2,0])))/( 1 + 0.5*b*dt )
    

    #boudary for y=Nxy
    u[1:-1,Ny-1] = ((1+0.5*b*dt)*u_1[1:-1,Ny-1]+dt*V(x[1:-1],y[Ny-1])+0.5*dt*f(x[1:-1],y[Ny-1],0)+C2*q(x[1:-1],y[Ny-1])*(u_1[1:-1,Ny-2]-u_1[1:-1,Ny-1])+0.25*C1*((q(x[1:-1],y[Ny-1])+q(x[2:],y[Ny-1]))*(u_1[2:,Ny-1]-u_1[1:-1,Ny-1])-(q(x[1:-1],y[Ny-1])+q(x[:-1],y[Ny-1]))*(u_1[1:-1,Ny-1]-u_1[:-2,Ny-1])))/( 1 + 0.5*b*dt )

    return u


